<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Program your self - Designer Mode</title>
    <style>
        body {
            background-color: black;
            color: white;
            height: 100vh;
            margin: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden;
            font-family: sans-serif;
        }

        /* --- Main Terminal Display --- */
        #terminal-text {
            font-family: 'Courier New', Courier, monospace;
            font-size: 14px;
            letter-spacing: 2px;
            white-space: pre;
            opacity: 0.9;
            transition: color 0.1s;
        }

        /* --- Designer Overlay Controls --- */
        #controls-overlay {
            position: fixed;
            top: 20px;
            right: 20px;
            width: 340px;
            max-height: 90vh;
            background: rgba(20, 20, 20, 0.95);
            border: 1px solid #444;
            border-radius: 8px;
            padding: 15px;
            box-shadow: 0 0 20px rgba(0,0,0,0.8);
            overflow-y: auto;
            color: #ddd;
            font-size: 12px;
            z-index: 1000;
        }

        h2 { margin: 0 0 15px 0; font-size: 14px; border-bottom: 1px solid #444; padding-bottom: 5px; text-transform: uppercase; letter-spacing: 1px; color: #88ff88; }
        h3 { margin: 20px 0 10px 0; font-size: 12px; color: #aaa; text-transform: uppercase; border-top: 1px solid #333; padding-top: 10px;}

        .control-group { margin-bottom: 10px; }
        .control-group label { display: flex; justify-content: space-between; margin-bottom: 4px; }
        .control-group input[type="range"] { width: 100%; cursor: pointer; }
        
        .value-display { color: #88ff88; font-family: monospace; }

        /* --- Face List Styling --- */
        #face-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-top: 10px;
        }

        .face-item {
            background: #1a1a1a;
            border: 1px solid #333;
            padding: 8px;
            border-radius: 4px;
        }

        .face-controls {
            display: grid;
            grid-template-columns: 24px 40px 1fr 24px;
            gap: 6px;
            align-items: center;
            margin-bottom: 6px;
        }

        .face-preview {
            font-family: 'Courier New', Courier, monospace;
            font-size: 11px;
            color: #666;
            background: #000;
            padding: 4px;
            border-radius: 2px;
            letter-spacing: 1px;
            overflow-x: hidden;
            white-space: nowrap;
            text-overflow: ellipsis;
        }
        
        .face-preview span { color: #8f8; font-weight: bold; }

        input[type="number"], input[type="text"] {
            background: #333;
            border: 1px solid #555;
            color: white;
            padding: 4px;
            border-radius: 3px;
            font-family: monospace;
            font-size: 11px;
        }

        button {
            border: none;
            color: white;
            cursor: pointer;
            border-radius: 3px;
            height: 24px;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .play-btn { background: #242; color: #8f8; font-size: 10px; }
        .play-btn:hover { background: #363; }
        
        .del-btn { background: #522; color: #f88; }
        .del-btn:hover { background: #722; }

        #add-btn {
            width: 100%;
            margin-top: 15px;
            padding: 8px;
            background: #224422;
            color: #8f8;
            border: 1px solid #484;
            cursor: pointer;
            text-transform: uppercase;
            font-weight: bold;
            font-size: 10px;
        }
        #add-btn:hover { background: #363; }

        /* Scrollbar aesthetics */
        #controls-overlay::-webkit-scrollbar { width: 6px; }
        #controls-overlay::-webkit-scrollbar-track { background: #111; }
        #controls-overlay::-webkit-scrollbar-thumb { background: #444; border-radius: 3px; }

    </style>
</head>
<body>

    <div id="terminal-text">program your self</div>

    <div id="controls-overlay">
        <h2>Sequence Designer</h2>

        <div class="control-group">
            <label>Scramble Duration <span id="val-scramble-dur" class="value-display"></span></label>
            <input type="range" id="inp-scramble-dur" min="0" max="1000" step="10" value="30">
        </div>

        <div class="control-group">
            <label>Scramble Frames <span id="val-scramble-frames" class="value-display"></span></label>
            <input type="range" id="inp-scramble-frames" min="1" max="20" step="1" value="4">
        </div>

        <div class="control-group">
            <label>Face Hold Duration <span id="val-hold-dur" class="value-display"></span></label>
            <input type="range" id="inp-hold-dur" min="50" max="3000" step="10" value="100">
        </div>

        <h3>Glitch Map</h3>
        <div style="font-size: 10px; color: #666; margin-bottom:5px; display:flex; justify-content:space-between; padding:0 30px;">
            <span>Idx</span> <span>Face String</span>
        </div>
        
        <div id="face-list">
            </div>

        <button id="add-btn">+ Add New Glitch</button>
    </div>

    <script>
        const element = document.getElementById('terminal-text');
        
        // --- UPDATED BASE STRING ---
        const baseString = "program your self"; 
        
        const glitchChars = '!<>-_\\/[]{}—=+*^?#';

        // --- Configuration State ---
        const config = {
            scrambleDuration: 30, 
            scrambleFrames: 4,     
            holdDuration: 100      
        };

        // --- Data State ---
        // Indices updated to fit the 16-character string "program your self"
        let glitches = [
            { index: 2,  face: "^_^" },   // pr^_^am your self
            { index: 8,  face: "._." },   // program ._.rself (Replaces 'you')
            { index: 4,  face: "(o_o)" }, // prog(o_o)urself (Consumes middle space)
            { index: 8,  face: "@<@" },   // program @<@rself
            { index: 13, face: "T_T" },   // program yoursT_T (End of string)
            { index: 6,  face: ">w<" },   // progra>w<ourself
            { index: 0,  face: ">3>" },   // >3>gram your self
            { index: 12, face: "•o•" }    // program your•o•f
        ];

        // --- Helpers ---
        function randomString(length) {
            let result = '';
            for (let i = 0; i < length; i++) {
                result += glitchChars.charAt(Math.floor(Math.random() * glitchChars.length));
            }
            return result;
        }

        function getInjectedString(text, index) {
            const before = baseString.substring(0, index);
            const after = baseString.substring(index + text.length);
            return before + text + after;
        }

        function injectString(text, index) {
            element.innerText = getInjectedString(text, index);
        }

        const wait = (ms) => new Promise(resolve => setTimeout(resolve, ms));

        // --- The Glitch Logic ---
        async function triggerGlitch(targetGlitch = null) {
            
            const glitch = targetGlitch || (glitches.length > 0 ? glitches[Math.floor(Math.random() * glitches.length)] : null);
            
            if (!glitch) return;

            const len = glitch.face.length;
            if(len === 0) return; 

            // Handle edge case where duration is 0
            const frameTime = config.scrambleDuration > 0 ? (config.scrambleDuration / config.scrambleFrames) : 0;

            if(targetGlitch) element.style.color = "#88ff88"; 

            // --- ENTRY PHASE ---
            if (config.scrambleDuration > 0) {
                for(let i = 0; i < config.scrambleFrames; i++) {
                    injectString(randomString(len), glitch.index);
                    await wait(frameTime);
                }
            }

            // --- HOLD PHASE ---
            injectString(glitch.face, glitch.index);
            await wait(config.holdDuration);

            // --- EXIT PHASE ---
            if (config.scrambleDuration > 0) {
                for(let i = 0; i < config.scrambleFrames; i++) {
                    injectString(randomString(len), glitch.index);
                    await wait(frameTime);
                }
            }

            // --- RESET ---
            element.innerText = baseString;
            element.style.color = "white";
        }

        // --- UI & Controls Logic ---

        function initControls() {
            // Slider Elements
            const scrambleDurInput = document.getElementById('inp-scramble-dur');
            const scrambleFramesInput = document.getElementById('inp-scramble-frames');
            const holdDurInput = document.getElementById('inp-hold-dur');

            const scrambleDurVal = document.getElementById('val-scramble-dur');
            const scrambleFramesVal = document.getElementById('val-scramble-frames');
            const holdDurVal = document.getElementById('val-hold-dur');

            function syncInputs() {
                config.scrambleDuration = parseInt(scrambleDurInput.value);
                config.scrambleFrames = parseInt(scrambleFramesInput.value);
                config.holdDuration = parseInt(holdDurInput.value);

                scrambleDurVal.innerText = config.scrambleDuration + 'ms';
                scrambleFramesVal.innerText = config.scrambleFrames;
                holdDurVal.innerText = config.holdDuration + 'ms';
            }

            scrambleDurInput.addEventListener('input', syncInputs);
            scrambleFramesInput.addEventListener('input', syncInputs);
            holdDurInput.addEventListener('input', syncInputs);

            // Set initial UI values to match config
            scrambleDurInput.value = config.scrambleDuration;
            scrambleFramesInput.value = config.scrambleFrames;
            holdDurInput.value = config.holdDuration;
            syncInputs();

            renderFaceList();

            document.getElementById('add-btn').addEventListener('click', () => {
                glitches.push({ index: 0, face: "new" });
                renderFaceList();
            });
        }

        function renderFaceList() {
            const container = document.getElementById('face-list');
            container.innerHTML = '';

            glitches.forEach((g, idx) => {
                const item = document.createElement('div');
                item.className = 'face-item';

                // Controls Row
                const controlsDiv = document.createElement('div');
                controlsDiv.className = 'face-controls';

                // Play Button
                const playBtn = document.createElement('button');
                playBtn.className = 'play-btn';
                playBtn.innerText = '▶';
                playBtn.title = "Test this glitch";
                playBtn.onclick = () => triggerGlitch(g);

                // Index Input
                const idxInput = document.createElement('input');
                idxInput.type = 'number';
                idxInput.value = g.index;
                idxInput.min = 0;
                idxInput.max = baseString.length;
                idxInput.title = "Start Index";
                idxInput.onchange = (e) => {
                    let val = parseInt(e.target.value);
                    if(val < 0) val = 0;
                    if(val > baseString.length) val = baseString.length;
                    glitches[idx].index = val;
                    updatePreview();
                };

                // Face Input
                const faceInput = document.createElement('input');
                faceInput.type = 'text';
                faceInput.value = g.face;
                faceInput.title = "Face String";
                faceInput.oninput = (e) => {
                    glitches[idx].face = e.target.value;
                    updatePreview();
                };

                // Delete Button
                const delBtn = document.createElement('button');
                delBtn.className = 'del-btn';
                delBtn.innerText = '×';
                delBtn.title = "Remove";
                delBtn.onclick = () => {
                    glitches.splice(idx, 1);
                    renderFaceList();
                };

                controlsDiv.append(playBtn, idxInput, faceInput, delBtn);

                // Preview Row
                const previewDiv = document.createElement('div');
                previewDiv.className = 'face-preview';
                
                function updatePreview() {
                    const before = baseString.substring(0, glitches[idx].index);
                    const face = glitches[idx].face;
                    const after = baseString.substring(glitches[idx].index + face.length);
                    previewDiv.innerHTML = `${before}<span>${face}</span>${after}`;
                }
                
                updatePreview(); // Initial call

                item.append(controlsDiv, previewDiv);
                container.appendChild(item);
            });
        }

        // Start
        initControls();
        setInterval(() => triggerGlitch(), 3000);

    </script>
</body>
</html>
